import { useGame } from '../store/game';
import { SoundSettings } from '../sounds/SoundSettings';
import './PausePopup.css';
import { useClickSound } from '../hooks/useClickSound';

interface PausePopupProps {
  isOpen: boolean;
  onClose: () => void;
}

export function PausePopup({ isOpen, onClose }: PausePopupProps) {
  const resetRun = useGame((s) => s.resetRun);
  const restartGame = useGame((s) => s.restartGame);
  const setGamePhase = useGame((s) => s.setGamePhase);
  const { withClickSound } = useClickSound();

  if (!isOpen) return null;

  const handleMainMenu = withClickSound(() => {
    resetRun();
    setGamePhase('enter');
    onClose();
  });

  const handleRestart = withClickSound(() => {
    restartGame();
    onClose();
  });

  const handleResume = withClickSound(() => {
    onClose();
  });

  return (
    <div className="popup-overlay" onClick={withClickSound(onClose)}>
      <div className="popup-modal pause-modal" onClick={(e) => e.stopPropagation()}>
        
        <div className="popup-content">
          <h2 className="popup-title">Paused</h2>
          
          <div className="pause-content">
            <SoundSettings />
            
            <div className="pause-buttons">
              <button className="pause-resume-button" onClick={handleResume}>
                Resume
              </button>
              
              <button className="pause-main-menu-button" onClick={handleRestart}>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 27 27" 
                  className="restart-icon" style={{marginRight:'0.08em'}}>
                  <path xmlns="http://www.w3.org/2000/svg" d="M11.2529 0.0127665C11.5235 0.0439992 11.7644 0.0987357 11.9746 0.177806C12.0525 0.214054 12.1337 0.223678 12.2178 0.206126C12.2958 0.242565 12.3898 0.267846 12.498 0.280345C12.6362 0.268886 12.7626 0.241809 12.877 0.200266C13.0153 0.188855 13.1659 0.192297 13.3281 0.211009C14.0744 0.160065 14.8003 0.175673 15.5039 0.256907C16.1771 0.362145 16.832 0.628934 17.4678 1.05866C17.9298 1.33132 18.3863 1.53569 18.8369 1.66999C18.9928 1.74272 19.1523 1.78892 19.3145 1.80769C19.4705 1.88052 19.6272 1.95263 19.7832 2.02546C19.8009 2.1098 19.8513 2.26719 19.9346 2.49617C20.0666 2.53881 20.199 2.58145 20.3311 2.62409C20.4631 2.66678 20.5772 2.74858 20.6729 2.86921C20.7446 2.95965 20.8318 3.038 20.9336 3.10456C21.1878 3.42512 21.4636 3.53981 21.7422 3.70027C22.2176 3.25472 22.4066 3.40737 22.7393 2.78327C23.0795 2.14488 23.5939 1.21948 24.0918 1.1739C24.3886 1.19012 24.5739 1.3403 24.6348 1.62605C25.1038 2.97302 25.5799 3.60565 25.6035 4.99714C25.6037 5.13451 25.6066 5.29109 25.6123 5.46687C25.596 5.62639 25.627 5.77014 25.7041 5.89656C25.8582 6.14925 25.9442 6.40249 25.9609 6.65534C25.9942 6.88614 26.0082 7.12018 26.0029 7.35652C26.0308 7.68634 26.0693 8.02488 26.1191 8.37117C26.1691 8.71746 26.2579 9.05841 26.3848 9.39363C26.5004 9.65181 26.5694 9.9266 26.5918 10.2178C26.6306 10.4873 26.6692 10.757 26.708 11.0264C26.6093 11.296 26.5075 11.5463 26.4033 11.7774C26.2936 11.97 26.1951 12.171 26.1074 12.38C25.7667 12.4683 25.4369 12.5652 25.1182 12.67C24.7993 12.7749 24.4608 12.8828 24.1035 12.9932C23.8448 12.834 23.5609 12.776 23.2529 12.8204C22.9451 12.8647 22.6291 12.8514 22.3047 12.7803C21.8976 12.6818 21.4845 12.6143 21.0664 12.5762C20.6429 12.4998 20.2056 12.5333 19.7549 12.6768C19.4142 12.7651 19.0541 12.7867 18.6748 12.7432C18.2953 12.6997 17.6691 12.8971 17.3721 12.8809C17.1246 12.7988 16.6156 12.864 16.5 12.7432C16.2171 12.4476 16.8123 11.4877 17 11.3C17.3721 11.1645 17.9463 9.99718 18.1 9.7C18.1256 9.63902 18.4794 9.06472 18.5 9C18.3892 8.7735 17.496 8.13639 17.3721 7.9387C17.0151 7.80433 16.3896 7.72299 16 7.5C15.3971 7.19528 14.8148 6.97292 14.5 6.5C14.4416 6.4265 14.3655 6.36674 14.2705 6.32227C14.1751 6.27772 14.0134 6.24091 13.918 6.19636C13.5267 6.38624 13.1532 6.56118 12.7988 6.72175C12.4075 6.91165 12.0194 7.06786 11.6357 7.19148C11.3184 7.32274 11.0156 7.47345 10.7275 7.64167C10.4397 7.80986 10.2108 8.05234 10.04 8.36824L9.87305 8.50007C9.51883 8.6606 9.22648 8.86153 8.99707 9.10359C8.75999 9.41201 8.5045 9.73558 8.23047 10.0733C8.11828 10.4634 8.02037 10.8728 7.9375 11.2999C7.81775 11.7558 7.66851 12.1746 7.49023 12.5567C7.64189 13.2794 7.69461 13.9917 7.64746 14.6915C7.60032 15.3911 7.70728 16.0587 7.96973 16.6934C8.13792 16.9814 8.35103 17.1746 8.6084 17.2716C8.89519 17.4054 9.1091 17.5976 9.24805 17.8487C9.30674 17.9225 9.43526 17.9713 9.63379 17.9942C9.72936 18.0389 9.86524 18.172 10.041 18.3936C10.0627 18.4968 10.1182 18.6041 10.2061 18.7149L10.4258 18.9923C11.0069 19.1937 11.5408 19.3726 12.0264 19.5294C12.5412 19.7231 13.0596 19.8843 13.582 20.0118C13.6407 20.0857 13.7073 20.0929 13.7812 20.0343C13.8844 20.0127 14.0171 20.028 14.1787 20.0801C14.8072 19.5819 15.6238 19.2067 16.627 18.9532C17.2464 18.8232 17.7975 18.4156 18.2793 17.7325C18.3161 17.703 18.3571 17.6408 18.4014 17.546C18.4036 17.527 18.4054 17.5051 18.4082 17.4805L20.4199 17.7247L21.7881 18.8985L24.21 19.6954L25.0801 20.8057C24.9739 21.0414 24.8494 21.2519 24.7012 21.4346C24.4711 21.7646 24.2398 22.0949 24.0098 22.4249L23.2852 23.0001C23.0438 23.1914 22.8054 23.3559 22.5703 23.4932L22.1631 23.8165C21.7355 23.959 21.3554 24.1617 21.0234 24.4249C20.6613 24.712 20.3256 25.0026 20.0176 25.296L19.5645 25.6553C19.4074 25.829 19.2533 25.9762 19.1025 26.0958C18.856 26.0947 18.6506 26.0852 18.4883 26.0665C18.3198 26.1018 18.1274 26.1061 17.9111 26.0811C17.7968 26.1227 17.6704 26.1497 17.5322 26.1612C17.3938 26.1726 17.2511 26.2118 17.1064 26.2774C16.6602 26.582 16.1755 26.7457 15.6523 26.7676C15.0987 26.8134 14.5744 26.8352 14.0811 26.8331L13.8652 26.5616C13.7934 26.471 13.7065 26.3909 13.6045 26.3243C13.4848 26.1738 13.2861 26.1111 13.0098 26.1339C12.8954 26.1755 12.7769 26.2443 12.6562 26.3399C12.5357 26.4354 12.3909 26.4999 12.2227 26.5352C12.0666 26.4624 11.8829 26.3867 11.6729 26.3077C11.4327 26.2526 11.2071 26.1855 10.9971 26.1065C10.7806 26.0815 10.5631 26.0563 10.3467 26.0313C10.1307 26.0063 9.93267 25.9426 9.75293 25.8399C9.6447 25.8274 9.5385 25.7874 9.43652 25.7208C9.30467 25.6782 9.20005 25.638 9.12207 25.6016L8.63477 25.546C8.47251 25.5272 8.3158 25.454 8.16602 25.3272C7.93817 25.1639 7.67975 25.0238 7.3916 24.9083C7.10334 24.7927 6.83289 24.638 6.58105 24.4444C6.47909 24.3778 6.3616 24.324 6.22949 24.2813C6.06729 24.2626 5.89311 24.2286 5.70703 24.1798C5.43119 23.9559 5.15827 23.7038 4.88867 23.4259C4.58907 23.172 4.27056 22.9572 3.93457 22.7813C3.55701 22.491 3.30907 22.1465 3.19043 21.7491C3.1312 21.5507 3.05609 21.3641 2.9668 21.1895C2.87734 21.0148 2.75717 20.8634 2.60742 20.7364C2.55339 20.7301 2.51669 20.6839 2.49902 20.5997L2.3916 20.4649C2.32086 20.1277 2.17823 19.8225 1.96289 19.5509C1.71734 19.3032 1.48335 19.0701 1.26172 18.8526L1.21191 17.8594L0.745117 17.2706C0.757596 17.1625 0.772312 17.0273 0.791016 16.8653C0.833699 16.7331 0.883299 16.5461 0.938477 16.3057C0.831352 16.0466 0.742604 15.7483 0.671875 15.4112C0.570921 15.0979 0.46658 14.811 0.359375 14.5518L0 14.0987C0.0250663 13.8824 0.0929548 13.6569 0.202148 13.4229C0.311233 13.1889 0.353875 12.9329 0.331055 12.6563C0.379938 12.4703 0.441902 12.2995 0.514648 12.1436C0.587476 11.9876 0.663117 11.8039 0.742188 11.5938C0.778622 11.5158 0.842151 11.44 0.932617 11.3682C1.01681 11.3505 1.07687 11.3027 1.11328 11.2247C1.56591 10.8657 1.62489 10.4753 1.29004 10.0528C1.45453 9.57817 1.60749 9.0879 1.74805 8.58308C1.85842 8.10216 1.98346 7.60844 2.12402 7.10359C2.32609 6.3043 2.77543 5.50622 3.4707 4.70906C3.71837 4.46346 3.91483 4.18432 4.06055 3.87214C4.23018 3.59015 4.42666 3.31098 4.65039 3.03523C4.71074 2.98737 4.79865 2.94208 4.91309 2.90046C5.0275 2.85883 5.10323 2.79881 5.13965 2.72077C5.47785 2.40348 5.87972 2.1347 6.34375 1.91413C6.48822 1.84858 6.60935 1.7528 6.70605 1.62702C6.80265 1.50136 6.88365 1.38706 6.9502 1.28523C7.18544 1.14785 7.42198 1.0105 7.65723 0.873118C7.89245 0.735748 8.1428 0.5852 8.4082 0.423899C8.77539 0.329287 9.14003 0.262317 9.50098 0.221751C9.83168 0.205111 10.166 0.161552 10.5029 0.0908915C10.7319 0.00763343 10.9823 -0.018471 11.2529 0.0127665Z"/>
                </svg> Restart
              </button>
              
              <button className="pause-main-menu-button" onClick={handleMainMenu}>
                â† Main Menu
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
